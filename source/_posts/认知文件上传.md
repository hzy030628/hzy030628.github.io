---
uuid: 47434195-5ea6-5f41-21a9-fe5974f651fb
title: 认知文件上传
date: 2022-04-30 19:58:59
tags: 
      - 文件上传漏洞
      - Web
      - CTF
categories: 
      - [Web]
      - [CTF]
---

今天系统的又看了一下文件上传，毕竟学习这个东西，不能学一半，要不然就等于没学，所所以今天系统的看了一下！

<!--more-->

# 什么是文件上传漏洞

文件上传漏洞是指由于程序员在对用户文件上传部分的控制不足或者处理缺陷，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。

# 什么是webshell

WebShell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。 WebShell后门隐蔽较性高，可以轻松穿越防火墙，访问WebShell时不会留下系统日志，只会在网站的web日志中留下一些数据提交记录。

# 一句话木马

一句哈木马分成php，asp，jsp格式的木马，在这里收集记录一下，方便后续使用！

## PHP

![image-20220430200723794](https://img-blog.csdnimg.cn/img_convert/e92107bdd324532e4255ea131c7f9f65.png)

![image-20220430200756208](https://img-blog.csdnimg.cn/img_convert/40fed571f64fcd3d27141793ee5a035d.png)

![image-20220430200834109](https://img-blog.csdnimg.cn/img_convert/0292e31bfdcc4a5a3b0c3893e7daacb9.png)

![image-20220430201001714](https://img-blog.csdnimg.cn/img_convert/453c73d54515ba9c7c0a1bed88563bd4.png)

## JSP

![image-20220430201106701](https://img-blog.csdnimg.cn/img_convert/5cba44214116ba54a26fdf75eb0094b0.png)

## ASP

![image-20220430201135791](https://img-blog.csdnimg.cn/img_convert/716d2cb6c6917569506efc725c535e7b.png)

## ASPX

![image-20220430201154680](https://img-blog.csdnimg.cn/img_convert/155759047f41c1ce8545e1d4b8717c05.png)

# 图片马制作

图片马的制作：

1.一句话木马代码，建在php文件里，命名为1.php

2.用快捷键“win+R”打开cmd，先进入到先前准备好的两个文件的存放路径，然后敲命令行：copy 1.jpg/b + 1.php muma.jpg

# 产生文件上传漏洞的原因

## 原因：

对于上传文件的后缀名（扩展名）没有做较为严格的限制
对于上传文件的MIMETYPE(用于描述文件的类型的一种表述方法) 没有做检查
权限上没有对于上传的文件目录设置不可执行权限，（尤其是对于shebang类型的文件）
web server对于上传文件或者指定目录的行为没有做限制

## 原理：

在 WEB 中进行文件上传的原理是通过将表单设为 multipart/form-data，同时加入文件域，而后通过 HTTP 协议将文件内容发送到服务器，服务器端读取这个分段 (multipart) 的数据信息，并将其中的文件内容提取出来并保存的。通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上

# 文件上传后导致的常见安全问题

上传文件是Web脚本语言，服务器的Web容器解释并执行了用户上传的脚本,导致代
码执行;

上传文件是Flash的策略文件crossdomain.xml,黑客用以控制Flash在该域下的行为(其
他通过类似方式控制策略文件的情况类似);

上传文件是病毒、木马文件，黑客用以诱骗用户或者管理员下载执行:

上传文件是钓鱼图片或为包含了脚本的图片，在某些版本的浏览器中会被作为脚本执
行，被用于钓鱼和欺诈。

除此之外，还有一些不常见的利用方法，比如将上传文件作为一个入口,溢出服务器的后台处理程序，如图片解析模块;或者上传-一个合法的文本文件， 其内容包含了PHP脚本，再通过“本地文件包含漏洞(Local File Include)"执行此脚本;等等。

# 总结

基本上对于文件上传漏洞，理论知识知道这些就可以了，其他的就是靠刷题积累解决方法！
